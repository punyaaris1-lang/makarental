<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MAKA Admin ‚Äì Tagihan</title>

<style>
body{margin:0;background:#050814;color:#fff;font-family:Inter}
.app{max-width:520px;margin:auto;padding:20px;padding-bottom:120px}
.card{background:#0b1324;border-radius:16px;padding:20px;margin-bottom:18px}
h2,h3{margin:0 0 10px}
label{font-size:.8em;color:#aaa;display:block;margin-top:12px}
input,select,button{
 width:100%;padding:12px;border-radius:10px;
 background:#020512;color:#fff;
 border:1px solid rgba(255,255,255,.1);margin-top:6px
}
button{background:#ffe600;color:#000;font-weight:700;margin-top:16px}
.user{padding:12px;border:1px solid rgba(255,255,255,.08);border-radius:12px;margin-top:10px}
.small{font-size:.75em;color:#aaa}
.badge{font-size:.7em;padding:4px 8px;border-radius:6px}
.unpaid{background:#ff4545}
.paid{background:#00dfff;color:#000}
.qr{
 background:#fff;color:#000;
 padding:20px;border-radius:12px;
 text-align:center;margin-top:10px
}
.bottom{
 position:fixed;bottom:0;left:50%;transform:translateX(-50%);
 width:100%;max-width:520px;height:90px;
 background:#020512;border-top:1px solid rgba(255,255,255,.08)
}
</style>
</head>

<body>
<div class="app">

<div class="card" id="loginCard">
<h2>üîê Admin Login</h2>
<input id="pass" type="password" placeholder="Password admin">
<button onclick="login()">MASUK</button>
</div>

<div id="panel" style="display:none">

<div class="card">
<h3>üìÑ Buat Tagihan</h3>

<label>Pilih User</label>
<select id="userSelect"></select>

<label>Tanggal Tagihan</label>
<input type="date" id="billDate">

<label>Jenis Tagihan</label>
<select id="billType" onchange="autoNominal()">
  <option value="harian">Sewa Harian</option>
  <option value="dp">Cicilan DP</option>
  <option value="manual">Manual</option>
</select>

<label>Nominal</label>
<input type="number" id="amount">

<button onclick="createInvoice()">BUAT TAGIHAN</button>
</div>

<div class="card">
<h3>üìã Daftar Tagihan</h3>
<div id="invoiceList"></div>
</div>

</div>
</div>

<div class="bottom"></div>

<script>
/* ===== CONFIG ===== */
const ADMIN_PASS='1131'
const finance=JSON.parse(localStorage.getItem('maka_finance_settings'))||
{hwb_rate:80000,cdp_rate:70000}

/* ===== LOGIN ===== */
function login(){
 if(pass.value!==ADMIN_PASS)return alert('Password salah');
 loginCard.style.display='none';
 panel.style.display='block';
 loadUsers();
 renderInvoices();
}

/* ===== LOAD USER ===== */
function loadUsers(){
 const users=JSON.parse(localStorage.getItem('maka_users'))||[];
 userSelect.innerHTML='';
 users.forEach((u,i)=>{
   userSelect.innerHTML+=`<option value="${i}">
     ${u.nama} ‚Äì ${u.plat}
   </option>`;
 });
}

/* ===== AUTO NOMINAL ===== */
function autoNominal(){
 if(billType.value==='harian')amount.value=finance.hwb_rate;
 if(billType.value==='dp')amount.value=finance.cdp_rate;
 if(billType.value==='manual')amount.value='';
}

/* ===== BUAT TAGIHAN ===== */
function createInvoice(){
 const idx=userSelect.value;
 const date=billDate.value;
 const nominal=+amount.value;
 if(!date||!nominal)return alert('Lengkapi data');

 const invoices=JSON.parse(localStorage.getItem('maka_invoices'))||[];

 invoices.push({
   id:Date.now(),
   userIndex:idx,
   date:date,
   nominal:nominal,
   paid:false
 });

 localStorage.setItem('maka_invoices',JSON.stringify(invoices));
 alert('Tagihan dibuat');
 renderInvoices();
}

/* ===== RENDER TAGIHAN ===== */
function renderInvoices(){
 const list=document.getElementById('invoiceList');
 const users=JSON.parse(localStorage.getItem('maka_users'))||[];
 const invoices=JSON.parse(localStorage.getItem('maka_invoices'))||[];
 list.innerHTML='';

 invoices.forEach(inv=>{
   const user=users[inv.userIndex];
   list.innerHTML+=`
    <div class="user">
      <strong>${user.nama}</strong>
      <div class="small">${inv.date}</div>
      <div>Rp ${inv.nominal.toLocaleString('id-ID')}</div>
      <span class="badge ${inv.paid?'paid':'unpaid'}">
        ${inv.paid?'LUNAS':'BELUM'}
      </span>

      ${inv.paid?'':`
      <div class="qr">
        <strong>QRIS</strong><br>
        <small>Scan untuk bayar</small><br><br>
        <em>[ QRIS STATIC DI SINI ]</em>
      </div>
      <button onclick="markPaid(${inv.id})">TANDAI LUNAS</button>
      `}
    </div>
   `;
 });
}

/* ===== MARK PAID ===== */
function markPaid(id){
 const inv=JSON.parse(localStorage.getItem('maka_invoices'));
 const target=inv.find(i=>i.id===id);
 target.paid=true;
 localStorage.setItem('maka_invoices',JSON.stringify(inv));
 renderInvoices();
}
</script>
</body>
</html>
