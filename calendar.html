<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Kalender MAKA</title>

<style>
body{margin:0;background:#020512;color:#fff;font-family:Inter}
.app{max-width:520px;margin:auto;padding-bottom:120px}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:20px}
.box{
 aspect-ratio:1;border-radius:12px;
 display:flex;align-items:center;justify-content:center;
 border:1px solid rgba(255,255,255,.1)
}
.harian{border-color:#00dfff;color:#00dfff}
.cdp{border-color:#cc99ff;color:#cc99ff}
.libur{border-color:#ff4545;color:#ff4545}
.paid{background:#ffe600;color:#000}
.bottom{position:fixed;bottom:0;width:100%;max-width:520px;height:90px;
 background:#020512;border-top:1px solid rgba(255,255,255,.08)}
</style>
</head>

<body>
<div class="app">
<h2 style="padding:20px">Kalender Pembayaran</h2>
<div class="grid" id="grid"></div>
</div>
<div class="bottom"></div>

<script>
const user=JSON.parse(localStorage.getItem('maka_user'));
const finance=JSON.parse(localStorage.getItem('maka_finance_settings'))||{hwb_rate:80000,cdp_rate:70000};
const pay=JSON.parse(localStorage.getItem('maka_payments'))||{};
const now=new Date();now.setHours(0,0,0,0);

let dpLeft=6-user.dpTerbayar;

const view=new Date();
view.setDate(1);

const grid=document.getElementById('grid');
const days=new Date(view.getFullYear(),view.getMonth()+1,0).getDate();

for(let i=1;i<=days;i++){
 const d=new Date(view.getFullYear(),view.getMonth(),i);
 let cls='box';
 let price=0;

 if(i===31){cls+=' libur'}
 else if(user.dp==='355' && dpLeft>0 && (i===14||i===28)){
   cls+=' cdp';price=finance.cdp_rate;dpLeft--;
 }
 else if(user.dp==='755' && (i===14||i===28)){
   cls+=' libur'
 }
 else if(i!==14 && i!==28){
   cls+=' harian';price=finance.hwb_rate
 }

 if(pay[d.toDateString()])cls+=' paid';

 grid.innerHTML+=`<div class="${cls}" onclick="bayar('${d.toDateString()}',${price})">${i}</div>`;
}

function bayar(key,nom){
 if(nom===0)return alert('Hari libur');
 if(confirm('Bayar Rp '+nom.toLocaleString('id-ID')+'?')){
   pay[key]=true;
   localStorage.setItem('maka_payments',JSON.stringify(pay));
   location.reload();
 }
}
</script>
</body>
</html>
