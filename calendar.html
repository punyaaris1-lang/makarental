<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kalender - MAKA</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
/* THEME */
:root { --maka-black:#0f1724; --maka-white:#ffffff; --maka-teal:#0ea5a6; --bg-page:#f8fafc; --border:#e2e8f0; }
body { margin:0; font-family:'Inter'; background:var(--bg-page); color:var(--maka-black); padding-bottom:120px; }
.app-container { max-width:480px; margin:0 auto; padding:20px 24px; }

/* HEADER */
.header-simple { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; padding-top:10px; }
.page-title { font-family:'Syne'; font-weight:800; font-size:1.6em; margin:0; }
.plat-badge { font-size:0.85em; font-weight:700; background:#fff; padding:6px 12px; border-radius:8px; border:1px solid var(--border); }

/* NAV */
.cal-nav { display:flex; justify-content:space-between; align-items:center; background:#fff; padding:12px 20px; border-radius:16px; border:1px solid var(--border); margin-bottom:25px; box-shadow:0 2px 5px rgba(0,0,0,0.02); }
.month-label { font-family:'Syne'; font-weight:800; font-size:1.1em; text-transform:uppercase; }
.btn-nav { background:var(--maka-black); color:white; border:none; width:36px; height:36px; border-radius:50%; font-weight:bold; cursor:pointer; }

/* GRID */
.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; }
.day-name { text-align:center; font-size:0.75em; font-weight:700; color:#64748b; margin-bottom:10px; }
.date-cell { aspect-ratio:1; display:flex; align-items:center; justify-content:center; border-radius:12px; font-weight:700; font-size:0.9em; background:#fff; border:1px solid var(--border); position:relative; }
.date-cell.lunas { background:#dcfce7; color:#166534; border-color:#bbf7d0; }
.date-cell.tunggak { background:#fee2e2; color:#991b1b; border-color:#fecaca; cursor:pointer; }
.date-cell.disabled { background:#f8fafc; color:#cbd5e1; border:none; }
.date-cell.today { border:2px solid var(--maka-black); }

/* MODAL */
.modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:2000; }
.modal-content { background:white; width:85%; max-width:320px; padding:30px; border-radius:24px; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,0.2); }
.modal-title { font-family:'Syne'; font-size:1.4em; font-weight:800; margin:0 0 10px; }
.btn-row { display:flex; gap:10px; margin-top:20px; }
.btn-confirm { flex:1; padding:14px; background:var(--maka-black); color:white; border:none; border-radius:12px; font-weight:700; cursor:pointer; }
.btn-cancel { flex:1; padding:14px; background:#f1f5f9; color:#64748b; border:none; border-radius:12px; font-weight:700; cursor:pointer; }

/* FOOTER NAV */
footer.bottom-nav { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:var(--maka-black); border-radius:100px; padding:14px 35px; display:flex; gap:40px; box-shadow:0 20px 50px rgba(0,0,0,0.3); z-index:999; }
.nav-item { display:flex; flex-direction:column; align-items:center; text-decoration:none; color:#64748b; font-size:10px; font-weight:700; }
.nav-item span { font-size:22px; margin-bottom:3px; }
.nav-item.active span { color:#fbbf24; }
</style>
</head>
<body>

<div class="app-container">
    <div class="header-simple"><h1 class="page-title">Kalender</h1><div class="plat-badge" id="displayPlat">...</div></div>
    <div class="cal-nav"><button class="btn-nav" onclick="changeMonth(-1)">‚Äπ</button><div id="monthDisplay" class="month-label">...</div><button class="btn-nav" onclick="changeMonth(1)">‚Ä∫</button></div>
    <div class="cal-grid" id="calendarGrid"></div>
</div>

<div id="paymentModal" class="modal-overlay">
    <div class="modal-content">
        <h3 class="modal-title">Bayar Sewa?</h3>
        <p style="color:#64748b;">Tanggal: <b id="payDateDisplay">-</b><br>Nominal: <b id="payAmountDisplay" style="color:#0ea5a6;">-</b></p>
        <div class="btn-row"><button class="btn-cancel" onclick="document.getElementById('paymentModal').style.display='none'">Batal</button><button class="btn-confirm" onclick="executePayment()">Bayar</button></div>
    </div>
</div>

<footer class="bottom-nav">
    <a href="lokasi_fc.html" class="nav-item"><span>‚ö°</span>Lokasi</a>
    <a href="dashboard.html" class="nav-item"><span>üè†</span>Home</a>
    <a href="daftar_antrian.html" class="nav-item"><span>üé´</span>Antrian</a>
</footer>

<script>
const firebaseConfig={apiKey:"AIzaSyAk3G5aQUBVe_g7_peVu1F6xllP_RejGq0",authDomain:"rtomaka-e67b5.firebaseapp.com",projectId:"rtomaka-e67b5",storageBucket:"rtomaka-e67b5.firebasestorage.app",messagingSenderId:"472036722228",appId:"1:472036722228:web:11d520f9204db317d02c61"};
let db, currentUser=JSON.parse(localStorage.getItem('maka_user')), plusData=JSON.parse(localStorage.getItem('maka_plus_data'))||{active:false}, currentYear=new Date().getFullYear(), currentMonth=new Date().getMonth(), paidDates=[], selectedPayload=null;

function init(){ try{if(!firebase.apps.length)firebase.initializeApp(firebaseConfig);db=firebase.firestore();}catch(e){} if(!currentUser){window.location.href='index.html';return;} document.getElementById('displayPlat').innerText=currentUser.plat; loadData(); }
function loadData(){ db.collection('daily_payments').where('plat','==',currentUser.plat).onSnapshot(s=>{ paidDates=[]; s.forEach(d=>paidDates.push(d.data().date)); renderCalendar(); }); }
function getDailyPrice(d){if(d.getDate()===31)return 0;const diff=Math.ceil(Math.abs(d-new Date(currentUser.joinedAt))/86400000);return(plusData.active&&diff<=365)?80000:70000;}

function renderCalendar(){
    const g=document.getElementById('calendarGrid'); g.innerHTML='<div class="day-name">M</div><div class="day-name">S</div><div class="day-name">S</div><div class="day-name">R</div><div class="day-name">K</div><div class="day-name">J</div><div class="day-name">S</div>';
    const dim=new Date(currentYear,currentMonth+1,0).getDate(), fd=new Date(currentYear,currentMonth,1).getDay(), join=new Date(currentUser.joinedAt), today=new Date(); join.setHours(0,0,0,0); today.setHours(0,0,0,0);
    document.getElementById('monthDisplay').innerText=new Date(currentYear,currentMonth).toLocaleDateString('id',{month:'long',year:'numeric'});
    for(let i=0;i<fd;i++)g.innerHTML+=`<div></div>`;
    for(let d=1;d<=dim;d++){
        let k=`${currentYear}-${(currentMonth+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`, cd=new Date(k); cd.setHours(0,0,0,0);
        let cls="date-cell", act="";
        if(d===31||cd<join||cd>today)cls+=" disabled";
        else if(paidDates.includes(k))cls+=" lunas";
        else{cls+=" tunggak"; act=`onclick="openPay('${k}')"`;}
        if(k===today.toISOString().split('T')[0])cls+=" today";
        g.innerHTML+=`<div class="${cls}" ${act}>${d}</div>`;
    }
}
function openPay(d){const p=getDailyPrice(new Date(d));selectedPayload={date:d,amount:p};document.getElementById('payDateDisplay').innerText=d;document.getElementById('payAmountDisplay').innerText="Rp "+p.toLocaleString('id');document.getElementById('paymentModal').style.display='flex';}
function executePayment(){if(!selectedPayload)return;db.collection('daily_payments').doc(currentUser.plat+'_'+selectedPayload.date).set({plat:currentUser.plat,nama:currentUser.nama,date:selectedPayload.date,amount:selectedPayload.amount,paidAt:firebase.firestore.FieldValue.serverTimestamp()}).then(()=>{document.getElementById('paymentModal').style.display='none';});}
function changeMonth(n){currentMonth+=n;if(currentMonth>11){currentMonth=0;currentYear++}else if(currentMonth<0){currentMonth=11;currentYear--}renderCalendar();}
document.addEventListener("DOMContentLoaded",init);
</script>
</body>
</html>
