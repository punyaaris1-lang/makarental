<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kalender</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
:root { --pri:#0f1724; --acc:#0ea5a6; --bg:#f8fafc; }
body { margin:0; font-family:'Inter'; background:var(--bg); color:var(--pri); padding-bottom:100px; }
.con { max-width:480px; margin:0 auto; padding:20px; }
h1 { font-family:'Syne'; margin:0 0 20px 0; }
.nav { display:flex; justify-content:space-between; align-items:center; background:#fff; padding:15px; border-radius:16px; border:1px solid #e2e8f0; margin-bottom:20px; }
.mon { font-family:'Syne'; font-weight:800; font-size:1.1em; text-transform:uppercase; }
.btn { background:var(--pri); color:#fff; width:35px; height:35px; border-radius:50%; border:none; cursor:pointer; }
.grid { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; }
.cel { aspect-ratio:1; display:flex; align-items:center; justify-content:center; background:#fff; border:1px solid #e2e8f0; border-radius:12px; font-weight:700; }
.cel.ok { background:#dcfce7; color:#166534; border-color:#86efac; }
.cel.no { background:#fee2e2; color:#991b1b; border-color:#fca5a5; cursor:pointer; }
.cel.dis { background:none; border:none; color:#cbd5e1; }
.mod { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; }
.box { background:#fff; padding:30px; border-radius:24px; text-align:center; width:80%; }
.pay { width:100%; padding:14px; background:var(--pri); color:#fff; border:none; border-radius:12px; font-weight:700; margin-top:15px; cursor:pointer; }
footer { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:var(--pri); padding:12px 30px; border-radius:50px; display:flex; gap:30px; z-index:99; }
.ni { text-decoration:none; color:#94a3b8; font-size:9px; font-weight:700; display:flex; flex-direction:column; align-items:center; }
.ni span { font-size:20px; margin-bottom:2px; }
</style>
</head>
<body>
<div class="con">
    <h1>Kalender</h1>
    <div class="nav"><button class="btn" onclick="ch(-1)">‚Äπ</button><span class="mon" id="tm">...</span><button class="btn" onclick="ch(1)">‚Ä∫</button></div>
    <div class="grid" id="gr"></div>
</div>
<div class="mod" id="md"><div class="box"><h3>Bayar?</h3><p id="inf">...</p><button class="pay" onclick="doPay()">BAYAR</button><br><br><small onclick="document.getElementById('md').style.display='none'">Batal</small></div></div>
<footer><a href="lokasi_fc.html" class="ni"><span>‚ö°</span>Lokasi</a><a href="dashboard.html" class="ni"><span>üè†</span>Home</a><a href="daftar_antrian.html" class="ni"><span>üé´</span>Antrian</a></footer>
<script>
const c={apiKey:"AIzaSyAk3G5aQUBVe_g7_peVu1F6xllP_RejGq0",authDomain:"rtomaka-e67b5.firebaseapp.com",projectId:"rtomaka-e67b5",storageBucket:"rtomaka-e67b5.firebasestorage.app",messagingSenderId:"472036722228",appId:"1:472036722228:web:11d520f9204db317d02c61"};
try{if(!firebase.apps.length)firebase.initializeApp(c);var db=firebase.firestore();}catch(e){}
let u=JSON.parse(localStorage.getItem('maka_user')), Y=new Date().getFullYear(), M=new Date().getMonth(), pd=[], sd, sp;
if(u) db.collection('daily_payments').where('plat','==',u.plat).onSnapshot(s=>{pd=[];s.forEach(d=>pd.push(d.data().date));render();});
function render(){
    const g=document.getElementById('gr'); g.innerHTML='';
    document.getElementById('tm').innerText=new Date(Y,M).toLocaleDateString('id',{month:'long',year:'numeric'});
    const dim=new Date(Y,M+1,0).getDate(), fd=new Date(Y,M,1).getDay();
    for(let i=0;i<fd;i++)g.innerHTML+='<div></div>';
    for(let d=1;d<=dim;d++){
        let k=`${Y}-${(M+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`, cl='cel', ac='';
        if(d==31 || new Date(k)<new Date(u.joinedAt) || new Date(k)>new Date()) cl+=' dis';
        else if(pd.includes(k)) cl+=' ok';
        else { cl+=' no'; ac=`onclick="ask('${k}')"`; }
        g.innerHTML+=`<div class="${cl}" ${ac}>${d}</div>`;
    }
}
function ask(d){ sd=d; sp=70000; document.getElementById('inf').innerText=`Tgl: ${d} | Rp 70.000`; document.getElementById('md').style.display='flex'; }
function doPay(){ db.collection('daily_payments').doc(u.plat+'_'+sd).set({plat:u.plat,date:sd,amount:sp,paidAt:new Date()}).then(()=>{document.getElementById('md').style.display='none'}); }
function ch(n){M+=n;if(M>11){M=0;Y++}else if(M<0){M=11;Y--}render();}
</script></body></html>
