<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalender Tagihan</title>
<link rel="stylesheet" href="css/app.css">
</head>

<body>
<div class="app">

<h3 style="padding:16px;margin:0">üìÖ Kalender Pembayaran</h3>
<div class="cal" id="calendar"></div>

</div>

<footer class="bottom-nav">
  <a href="lokasi_fc.html" class="nav-item"><span>‚ö°</span>FC</a>
  <a href="dashboard.html" class="nav-item"><span>üè†</span>Home</a>
  <a href="calendar.html" class="nav-item active"><span>üìÖ</span>Bayar</a>
</footer>

<style>
.cal{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
  padding:14px;
}
.day{
  border-radius:14px;
  padding:10px 0;
  font-size:.75em;
  text-align:center;
  border:1px solid rgba(0,0,0,.1);
  background:#ffffff22;
  backdrop-filter:blur(10px);
}
.pay{background:#dbe8ff}
.dp{background:#fff4d0}
.holiday{background:#ffd6d6}
.today{outline:2px solid #007aff}
.day b{display:block;font-size:1em}
.day small{opacity:.8}
</style>

<script src="app.js"></script>
<script>
const user = getActiveUser();
if(!user) location.href='index.html';

const cal = document.getElementById('calendar');
const now = new Date();
now.setHours(0,0,0,0);
const y = now.getFullYear();
const m = now.getMonth();

const daysInMonth = new Date(y, m+1, 0).getDate();

for(let d=1; d<=daysInMonth; d++){
  const date = new Date(y,m,d);
  const iso = date.toISOString().slice(0,10);

  const box = document.createElement('div');
  box.className = 'day';
  box.innerHTML = `<b>${d}</b>`;

  if(+date === +now) box.classList.add('today');

  if(isHoliday(user, iso)){
    box.classList.add('holiday');
    box.innerHTML += `<small>Libur</small>`;
  }
  else if(isDPDay(user, iso)){
    box.classList.add('dp');
    box.innerHTML += `<small>DP</small>`;
  }
  else{
    const rate = getDailyRate(user, iso);
    box.classList.add('pay');
    box.innerHTML += `<small>${formatIDR(rate)}</small>`;
    box.onclick = ()=> confirmPay(iso, rate);
  }

  cal.appendChild(box);
}

function confirmPay(date, amount){
  if(confirm(`Bayar tanggal ${date}\nTagihan: ${formatIDR(amount)}`)){
    markPaid(date);
    alert('‚úÖ Dicatat sebagai dibayar');
    location.reload();
  }
}
</script>

</body>
</html>
