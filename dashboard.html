<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
:root { --pri:#0f1724; --acc:#0ea5a6; --yel:#fbbf24; --bg:#f8fafc; }
body { margin:0; font-family:'Inter'; background:var(--bg); color:var(--pri); padding-bottom:100px; }
.con { max-width:480px; margin:0 auto; padding:20px; }
.head { display:flex; justify-content:space-between; margin-bottom:20px; align-items:center; }
h1 { font-family:'Syne'; margin:0; font-size:1.5em; }
.sub { color:#64748b; font-size:0.9em; }
.av { width:45px; height:45px; background:var(--pri); color:var(--yel); border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:'Syne'; font-weight:800; background-size:cover; }

/* HERO CARD HITAM */
.hero { background:var(--pri); color:#fff; padding:25px; border-radius:24px; position:relative; overflow:hidden; box-shadow:0 15px 40px rgba(15,23,36,0.2); margin-bottom:30px; }
.hero::after { content:'MAKA'; position:absolute; bottom:-20px; right:-10px; font-family:'Syne'; font-size:4em; font-weight:900; color:rgba(255,255,255,0.05); }
.lbl { font-size:0.7em; font-weight:700; opacity:0.7; letter-spacing:1px; }
.val { font-family:'Syne'; font-size:2.5em; font-weight:800; margin:5px 0; line-height:1; }
.pill { float:right; background:rgba(255,255,255,0.2); padding:5px 10px; border-radius:20px; font-size:0.7em; font-weight:800; }
.pill.red { background:#ef4444; color:#fff; }
.bar-bg { background:rgba(255,255,255,0.1); height:6px; border-radius:10px; margin-top:20px; overflow:hidden; }
.bar-fill { background:var(--yel); height:100%; width:0%; transition:1s; }

/* MENU */
.grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
.card { background:#fff; border:1px solid #e2e8f0; padding:15px; border-radius:16px; text-align:center; text-decoration:none; color:var(--pri); display:flex; flex-direction:column; align-items:center; transition:0.2s; }
.card:active { transform:scale(0.95); background:#f1f5f9; }
.ico { font-size:24px; margin-bottom:5px; filter:grayscale(100%); }
.card:active .ico { filter:grayscale(0%); }
.txt { font-size:0.75em; font-weight:700; }

/* NAV */
footer { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:var(--pri); padding:12px 30px; border-radius:50px; display:flex; gap:30px; box-shadow:0 10px 30px rgba(0,0,0,0.2); z-index:99; }
.nav-i { display:flex; flex-direction:column; align-items:center; text-decoration:none; color:#94a3b8; font-size:9px; font-weight:700; }
.nav-i span { font-size:20px; margin-bottom:2px; }
.nav-i.act { color:#fff; } .nav-i.act span { color:var(--yel); }
</style>
</head>
<body>
<div class="con">
    <div class="head"><div><h1>Halo...</h1><p class="sub" id="pl">Loading...</p></div><div class="av" id="av">U</div></div>
    <div class="hero">
        <span class="pill" id="st">...</span><span class="lbl">TAGIHAN</span>
        <div class="val" id="rp">Rp 0</div>
        <p style="font-size:0.9em; opacity:0.8; margin:0 0 10px 0;" id="ds">...</p>
        <div style="font-size:0.7em; display:flex; justify-content:space-between;"><span>PROGRESS</span><span id="dy">0/1009</span></div>
        <div class="bar-bg"><div class="bar-fill" id="bf"></div></div>
    </div>
    <h3 style="font-family:'Syne'; border-left:4px solid var(--acc); padding-left:10px;">Menu Utama</h3>
    <div class="grid">
        <a href="calendar.html" class="card"><div class="ico">üìÖ</div><span class="txt">Bayar</span></a>
        <a href="history.html" class="card"><div class="ico">üßæ</div><span class="txt">Riwayat</span></a>
        <a href="part_tracker.html" class="card"><div class="ico">üéÅ</div><span class="txt">Gratisan</span></a>
        <a href="settings.html" class="card"><div class="ico">‚öôÔ∏è</div><span class="txt">Setting</span></a>
        <a href="info_mlu.html" class="card"><div class="ico">üí°</div><span class="txt">Info MLU</span></a>
        <a href="tips_maka.html" class="card"><div class="ico">üìñ</div><span class="txt">Panduan</span></a>
        <a href="maka_plus.html" class="card"><div class="ico">‚ú®</div><span class="txt">MAKA+</span></a>
        <button onclick="window.open('https://wa.me/6281234567890','_blank')" class="card"><div class="ico">üí¨</div><span class="txt">CS WA</span></button>
        <button onclick="location.href='daftar_antrian.html?mode=SOS'" class="card" style="background:#fee2e2; border-color:#fecaca"><div class="ico">üö®</div><span class="txt" style="color:#dc2626">Darurat</span></button>
    </div>
</div>
<footer>
    <a href="lokasi_fc.html" class="nav-i"><span>‚ö°</span>Lokasi</a>
    <a href="dashboard.html" class="nav-i act"><span>üè†</span>Home</a>
    <a href="daftar_antrian.html" class="nav-i"><span>üé´</span>Antrian</a>
</footer>
<script>
const c={apiKey:"AIzaSyAk3G5aQUBVe_g7_peVu1F6xllP_RejGq0",authDomain:"rtomaka-e67b5.firebaseapp.com",projectId:"rtomaka-e67b5",storageBucket:"rtomaka-e67b5.firebasestorage.app",messagingSenderId:"472036722228",appId:"1:472036722228:web:11d520f9204db317d02c61"};
try{if(!firebase.apps.length)firebase.initializeApp(c);var db=firebase.firestore();}catch(e){}
let u=JSON.parse(localStorage.getItem('maka_user')), p=JSON.parse(localStorage.getItem('maka_plus_data'))||{active:false};
if(!u)location.href='index.html';
document.querySelector('h1').innerText=u.nama; document.getElementById('pl').innerText=u.plat;
if(u.photoUrl)document.getElementById('av').style.backgroundImage=`url('${u.photoUrl}')`,document.getElementById('av').innerText='';

db.collection('daily_payments').where('plat','==',u.plat).onSnapshot(s=>{
    let pd=[], tot=0, cur=new Date(u.joinedAt), now=new Date(), lt=0, dc=0; now.setHours(0,0,0,0); cur.setHours(0,0,0,0);
    s.forEach(d=>pd.push(d.data().date));
    while(cur<=now && dc<1009){
        let d=cur.toISOString().split('T')[0], pr=(cur.getDate()===31)?0:(p.active&&Math.ceil(Math.abs(cur-new Date(u.joinedAt))/864e5)<=365)?80000:70000;
        if(pr>0 && !pd.includes(d)){ tot+=pr; lt++; }
        cur.setDate(cur.getDate()+1); dc++;
    }
    document.getElementById('rp').innerText="Rp "+tot.toLocaleString('id');
    document.getElementById('dy').innerText=dc+"/1009"; document.getElementById('bf').style.width=(dc/1009)*100+"%";
    if(tot>0){ document.getElementById('st').innerText="TUNGGAKAN"; document.getElementById('st').className="pill red"; document.getElementById('ds').innerText=lt+" Hari Belum Bayar"; }
    else { document.getElementById('st').innerText="AMAN"; document.getElementById('st').className="pill"; document.getElementById('ds').innerText="Tidak ada tagihan."; }
});
</script>
</body></html>
