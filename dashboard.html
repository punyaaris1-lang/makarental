<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAKA Dashboard Premium</title>
    <link rel="stylesheet" href="styles.css"> 
    
    <style>
        .icon-grid-section {
            padding-top: 5px;
        }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px;
            text-align: center;
        }
        .icon-item {
            display: block;
            background: var(--card-bg);
            padding: 15px 10px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            text-decoration: none;
            transition: all 0.2s;
        }
        .icon-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 223, 255, 0.4);
        }
        .icon-item span {
            font-size: 1.8em;
            display: block;
            margin-bottom: 5px;
        }
        .icon-item p {
            font-size: 0.75em;
            color: var(--text-secondary);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="app-container">
        
        <header class="header">
            <a href="admin_login.html" style="position: absolute; top: 10px; right: 20px; font-size: 0.7em; color: #555; z-index: 200;">[ADMIN]</a>
            
            <div class="user-info">
                <h1>Halo, M Rizky Firdaus!</h1>
                <p>Plat Motor: B 4248 SWF</p>
            </div>
            
            <div class="hero-tunggakan">
                <div>
                    <h3>TOTAL TUNGGAKAN</h3>
                    <p style="font-size: 0.8em; color: var(--text-secondary);">Perlu dibayar sebelum hari ini</p>
                </div>
                <div class="hero-tunggakan-value">
                    <span id="hero-tunggakan-nominal">Rp 0</span>
                    <small id="hero-tunggakan-days">0 Hari Tertunggak</small>
                </div>
            </div>
            
            <div class="futuristic-divider"></div>

        </header>

        <section class="icon-grid-section">
            <h2>‚ú® Akses Fitur Premium</h2>
            <div class="icon-grid">
                
                <a href="calendar.html" class="icon-item">
                    <span style="color: var(--primary-neon);">üìÖ</span>
                    <p>Bayar & Kalender</p>
                </a>
                
                <a href="history.html" class="icon-item">
                    <span style="color: var(--secondary-neon);">üóíÔ∏è</span>
                    <p>Log Riwayat</p>
                </a>
                
                <a href="part_tracker.html" class="icon-item">
                    <span style="color: var(--paid-gold);">üéÅ</span>
                    <p>Cek Gratisan</p>
                </a>
                
                <a href="info_mlu.html" class="icon-item">
                    <span style="color: var(--primary-neon);">üì∞</span>
                    <p>Info MLU</p>
                </a>

                <a href="tips_maka.html" class="icon-item">
                    <span style="color: var(--secondary-neon);">üí°</span>
                    <p>Tips MAKA</p>
                </a>

                <a href="#" class="icon-item" onclick="window.open('https://etle-pmj.info/', '_blank')">
                    <span style="color: var(--holiday-color);">üö®</span>
                    <p>Cek ETLE</p>
                </a>
                
                <a href="settings.html" class="icon-item">
                    <span style="color: var(--dp-color);">‚öôÔ∏è</span>
                    <p>Pengaturan Akun</p>
                </a>
                
                <a href="#" class="icon-item" onclick="alert('Status Maka+ Aktif, Tambahan Rp 10.000/hari.')">
                    <span style="color: var(--paid-gold);">‚≠ê</span>
                    <p>Maka+ Status</p>
                </a>
                
                <div class="icon-item" style="opacity: 0.5; cursor: default;">
                    <span>...</span>
                    <p>Akan Datang</p>
                </div>
            </div>
        </section>


        <footer class="bottom-nav">
            <a href="lokasi_fc.html" class="nav-item">
                <span style="color: var(--primary-neon);">‚ö°</span>
                Lokasi FC
            </a>
            
            <a href="dashboard.html" class="nav-item active">
                <span>üè†</span>
                Home
            </a>
            
            <a href="daftar_antrian.html" class="nav-item">
                <span style="color: var(--paid-gold);">üé´</span>
                Antrian
            </a>
        </footer>
    </div>
    
    <script>
        // --- Data Kunci untuk Perhitungan (Diambil dari Admin atau Default) ---
        const USER_TGL_MULAI_SEWA = '2025-09-20'; // Tanggal Ambil Motor
        const USER_OPSI_DP = '355'; 

        // Ambil data tarif dari Local Storage (Admin Panel)
        const ADMIN_FINANCE = JSON.parse(localStorage.getItem('maka_finance_settings')) || { hwb_rate: 80000, cdp_rate: 70000 };
        const USER_TARIF_HARIAN = ADMIN_FINANCE.hwb_rate; // 80000
        const USER_TARIF_CICILAN_DP = ADMIN_FINANCE.cdp_rate; // 70000

        // Asumsi Periode Cicilan DP 3 bulan setelah ambil motor: Okt 2025 s/d Des 2025
        const DP_START_DATE = new Date(new Date(USER_TGL_MULAI_SEWA).getFullYear(), new Date(USER_TGL_MULAI_SEWA).getMonth() + 1, 1); 
        const DP_END_DATE = new Date(DP_START_DATE.getFullYear(), DP_START_DATE.getMonth() + 3, 1); 

        // Fungsi Penentuan Status Hari (Sama seperti di Calendar)
        function getDayStatus(date) {
            const dayOfMonth = date.getDate();
            const dateCheck = new Date(date.getFullYear(), date.getMonth(), dayOfMonth);
            
            if (dayOfMonth === 31) return 'HLB';

            if (USER_OPSI_DP === '355') {
                if (dateCheck >= DP_START_DATE && dateCheck < DP_END_DATE) {
                    if (dayOfMonth === 14 || dayOfMonth === 28) {
                        return 'CDP'; 
                    }
                } else if (dateCheck >= DP_END_DATE) {
                    if (dayOfMonth === 14 || dayOfMonth === 28) {
                        return 'HLB'; 
                    }
                }
            }
            return 'HWB'; 
        }

        // Fungsi Menghitung Tunggakan (Separated)
        function calculateOutstandingSeparately() {
            const today = new Date();
            const start = new Date(USER_TGL_MULAI_SEWA);
            start.setHours(0, 0, 0, 0); // Reset waktu agar perbandingan akurat
            today.setHours(0, 0, 0, 0); 
            
            let tunggakanSewa = 0;
            let hariTunggakSewa = 0;
            let tunggakanDP = 0;
            let hariTunggakDP = 0;
            
            const savedPayments = JSON.parse(localStorage.getItem('maka_payments')) || {};
            
            let currentDate = new Date(start); 
            
            while (currentDate <= today) {
                const dateKey = currentDate.getFullYear() + '-' + (currentDate.getMonth() + 1) + '-' + currentDate.getDate();
                const status = getDayStatus(currentDate);
                const isPaid = savedPayments[dateKey] === true;
                
                if (!isPaid) {
                    if (status === 'HWB') {
                        tunggakanSewa += USER_TARIF_HARIAN;
                        hariTunggakSewa += 1;
                    } else if (status === 'CDP') {
                        tunggakanDP += USER_TARIF_CICILAN_DP;
                        hariTunggakDP += 1;
                    }
                }
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return { tunggakanSewa, hariTunggakSewa, tunggakanDP, hariTunggakDP };
        }
        
        // --- LOGIKA UTAMA: HOOK UP DATA ---
        document.addEventListener('DOMContentLoaded', () => {
            const rekap = calculateOutstandingSeparately();
            
            const totalKeseluruhan = rekap.tunggakanSewa + rekap.tunggakanDP;
            const totalHari = rekap.hariTunggakSewa + rekap.hariTunggakDP;

            // Update Hero Area
            document.getElementById('hero-tunggakan-nominal').textContent = `Rp ${totalKeseluruhan.toLocaleString('id-ID')}`;
            document.getElementById('hero-tunggakan-days').textContent = `${totalHari} Hari Tertunggak`;

            // Hapus data hardcode yang tidak perlu (Opsional)
            // document.getElementById('hero-tunggakan-nominal').parentNode.querySelector('small').textContent = `${rekap.hariTunggakSewa} Hari Tertunggak`;
        });
    </script>
</body>
</html>
