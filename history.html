<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAKA Riwayat Transaksi</title>

<!-- inject app.css -->
<link rel="stylesheet" href="app.css">

</head>
<body>
<div class="app-container">

<header class="header neon-border">
    <div class="user-info">
        <h1>ğŸ—’ï¸ Riwayat Transaksi</h1>
        <p>Log pembayaran dan tunggakan Anda.</p>
    </div>
</header>

<section class="transaction-list">
    <h2 class="section-title">Aktivitas Pembayaran Bulan Ini</h2>

    <div id="history-log" class="history-loading">
        Memuat data transaksi...
    </div>
</section>


<footer class="bottom-nav">
    <a href="dashboard.html" class="nav-item">
        <span>ğŸ </span>Dashboard
    </a>
    <a href="calendar.html" class="nav-item">
        <span>ğŸ“…</span>Kalender
    </a>
    <a href="history.html" class="nav-item active">
        <span>ğŸ—’ï¸</span>Riwayat
    </a>
    <a href="settings.html" class="nav-item">
        <span>âš™ï¸</span>Pengaturan
    </a>
</footer>

</div>


<script>
const userData = {
    tarifNormal: 70000,
    tarifMakaPlus: 10000
};

// Baca dari kalender
const savedPayments = JSON.parse(localStorage.getItem('maka_payments')) || {};
const logContainer = document.getElementById('history-log');

function formatRupiah(number) {
    return new Intl.NumberFormat('id-ID', {
        style: 'currency', currency: 'IDR',
        minimumFractionDigits: 0
    }).format(number);
}

function generateHistory() {

    const today = new Date();
    let logHTML = '';

    for (let i = 0; i < 30; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);

        const y = date.getFullYear();
        const m = date.getMonth() + 1;
        const d = date.getDate();

        const key = `${y}-${m}-${d}`;
        const display = date.toLocaleDateString('id-ID', {
            weekday: 'short', day: 'numeric', month: 'long'
        });

        let amount = userData.tarifNormal;
        let type = 'HWB';
        let statusClass = 'unpaid';
        let statusText = 'Tunggakan';

        const paid = savedPayments[key] === true;

        if (paid) {
            statusClass = 'paid';
            statusText = 'Dibayar Lunas';
            type = 'Bayar HWB';
        }

        if (d === 14 || d === 28) {
            amount = 80000;
            type = 'Cicilan DP';
            statusClass = paid ? 'dp' : 'unpaid';
            statusText = paid ? 'Dibayar Lunas' : 'Tunggakan';
        }

        logHTML += `
            <div class="transaction-item ${statusClass}">
                <div class="transaction-details">
                    <h3>${type}</h3>
                    <small>${display} | Status: ${statusText}</small>
                </div>
                <div class="transaction-amount ${statusClass === 'unpaid' ? 'unpaid' : ''}">
                    ${formatRupiah(amount)}
                </div>
            </div>
        `;
    }

    logContainer.innerHTML =
        logHTML || `<p class="history-empty">Belum ada riwayat transaksi.</p>`;
}

document.addEventListener('DOMContentLoaded', generateHistory);
</script>

</body>
</html>
