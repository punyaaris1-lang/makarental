<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0f18">
<title>Riwayat Luxury</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
:root { --bg:#0a0f18; --gold:#D4AF37; --glass:rgba(255,255,255,0.03); --border:rgba(255,255,255,0.08); }
body { margin:0; font-family:'Inter'; background:var(--bg); color:#fff; padding-bottom:120px; }
.app-container { max-width:480px; margin:0 auto; padding:20px; }
h1 { font-family:'Syne'; color:var(--gold); margin-bottom:20px; }

/* CARD LIST */
.card { 
    background:var(--glass); border:1px solid var(--border); 
    padding:18px; border-radius:16px; margin-bottom:12px;
    display:flex; justify-content:space-between; align-items:center;
}
.left h4 { margin:0 0 5px; font-family:'Syne'; }
.left p { margin:0; font-size:0.8em; color:#94a3b8; }
.amt { font-family:'Syne'; font-size:1.2em; color:var(--gold); font-weight:800; display:block; text-align:right;}
.pill { font-size:0.6em; background:rgba(16, 185, 129, 0.2); color:#34d399; padding:4px 8px; border-radius:6px; }

/* NAV */
footer { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(20,27,45,0.8); backdrop-filter:blur(20px); padding:12px 30px; border-radius:100px; display:flex; gap:30px; border:1px solid var(--border); box-shadow:0 20px 40px rgba(0,0,0,0.5); }
.nav-item { display:flex; flex-direction:column; align-items:center; text-decoration:none; color:#64748b; font-size:9px; font-weight:700; }
.nav-item span { font-size:20px; margin-bottom:3px; filter:grayscale(100%); }
.nav-item.active span { filter:grayscale(0%); transform:translateY(-2px); }
</style>
</head>
<body>
<div class="app-container">
    <h1>Riwayat</h1>
    <div id="list">
        <p style="color:#666;text-align:center;">Memuat data...</p>
    </div>
</div>
<footer class="bottom-nav">
    <a href="lokasi_fc.html" class="nav-item"><span>‚ö°</span>Lokasi</a>
    <a href="dashboard.html" class="nav-item"><span>üè†</span>Home</a>
    <a href="daftar_antrian.html" class="nav-item"><span>üé´</span>Antrian</a>
</footer>
<script>
const firebaseConfig = { apiKey: "AIzaSyAk3G5aQUBVe_g7_peVu1F6xllP_RejGq0", authDomain: "rtomaka-e67b5.firebaseapp.com", projectId: "rtomaka-e67b5", storageBucket: "rtomaka-e67b5.firebasestorage.app", messagingSenderId: "472036722228", appId: "1:472036722228:web:11d520f9204db317d02c61" };
try{firebase.initializeApp(firebaseConfig); var db=firebase.firestore();}catch(e){}
let u=JSON.parse(localStorage.getItem('maka_user'));

if(u){
    // FIX ERROR INDEX: Hapus .orderBy() dan lakukan sort di Javascript
    db.collection('daily_payments').where('plat','==',u.plat).limit(50).onSnapshot(s=>{
        if(s.empty){ document.getElementById('list').innerHTML='<p style="text-align:center;color:#666">Belum ada data.</p>'; return; }
        
        let d = [];
        s.forEach(doc=>d.push(doc.data()));
        d.sort((a,b)=> new Date(b.date) - new Date(a.date)); // Sort manual disini
        
        let h = '';
        d.forEach(i=>{
            h += `<div class="card">
                <div class="left"><h4>${i.date}</h4><p>Lunas</p></div>
                <div class="right"><span class="amt">Rp 70.000</span><span class="pill">SUKSES</span></div>
            </div>`;
        });
        document.getElementById('list').innerHTML=h;
    });
}
</script>
</body>
</html>
