<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MAKA Riwayat</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&family=Syne:wght@700&display=swap" rel="stylesheet">

<style>
/* ================= THEME VARIABLES ================= */
:root {
  --bg: #f6f8fb;
  --surface: #ffffff;
  --muted: #9ca3af;
  --text: #0f1724;
  
  --accent: #0ea5a6;       /* Teal (Lunas) */
  --danger: #ef4444;       /* Merah (Tunggakan) */
  --purple: #8b5cf6;       /* Ungu (DP) */
  
  --radius-lg: 20px;
  --radius-md: 14px;
  --card-shadow: 0 4px 20px rgba(15,23,42,0.04);
  --max-width: 520px;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
  margin: 0; padding: 0;
  font-family: 'Inter', sans-serif;
  background: linear-gradient(180deg, var(--bg) 0%, #eef3f8 100%);
  color: var(--text);
  min-height: 100vh;
}

.app-container {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: 20px 20px 120px 20px;
}

/* ================= HEADER ================= */
.header {
  margin-bottom: 24px;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  padding-bottom: 16px;
}
.header h1 {
  font-family: 'Syne', sans-serif;
  font-size: 1.8em;
  font-weight: 800;
  margin: 0;
  color: var(--text);
  letter-spacing: -0.5px;
}
.header p {
  color: var(--muted);
  font-size: 0.95em;
  margin: 4px 0 0 0;
}

/* ================= HISTORY LIST ================= */
.history-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.history-card {
  background: var(--surface);
  border-radius: var(--radius-md);
  padding: 16px;
  box-shadow: var(--card-shadow);
  border: 1px solid rgba(15,23,42,0.03);
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  overflow: hidden;
  transition: transform 0.1s;
}

.history-card:active {
  transform: scale(0.98);
}

/* Status Indicator Bar (Left Side) */
.history-card::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 5px;
  background: #ccc; /* Default */
}

/* LEFT SIDE INFO */
.h-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.h-type {
  font-weight: 800;
  font-size: 1em;
  color: var(--text);
}
.h-date {
  font-size: 0.75em;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* RIGHT SIDE INFO */
.h-amount-box {
  text-align: right;
}
.h-amount {
  font-family: 'Syne', sans-serif;
  font-weight: 700;
  font-size: 1.1em;
  color: var(--text);
}
.h-status {
  font-size: 0.75em;
  font-weight: 700;
  display: inline-block;
  padding: 2px 8px;
  border-radius: 6px;
  margin-top: 4px;
}

/* COLOR VARIANTS */
/* PAID / LUNAS */
.card-paid::before { background: var(--accent); }
.card-paid .h-status {
  background: rgba(14, 165, 166, 0.1);
  color: var(--accent);
}

/* UNPAID / TUNGGAKAN */
.card-unpaid::before { background: var(--danger); }
.card-unpaid .h-status {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger);
}

/* DP (Cicilan) */
.card-dp::before { background: var(--purple); }
.card-dp .h-status {
  background: rgba(139, 92, 246, 0.1);
  color: var(--purple);
}

/* Empty State */
.empty-msg {
  text-align: center;
  color: var(--muted);
  font-size: 0.9em;
  padding: 40px 0;
  background: var(--surface);
  border-radius: var(--radius-lg);
  border: 1px dashed rgba(0,0,0,0.1);
}

/* ================= BOTTOM NAV ================= */
footer.bottom-nav {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 20px;
  width: calc(100% - 40px);
  max-width: 480px;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-radius: 999px;
  padding: 12px 20px;
  display: flex;
  justify-content: space-around;
  align-items: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.08);
  border: 1px solid rgba(255,255,255,0.5);
  z-index: 999;
}
.nav-item {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  text-decoration: none; color: var(--muted); font-size: 11px; gap: 4px;
}
.nav-item span { font-size: 20px; margin-bottom: 2px; }
.nav-item.active { color: var(--accent); font-weight: 700; }
.nav-item.active span { transform: scale(1.1); }
</style>
</head>

<body>
<div class="app-container">

<header class="header">
    <h1>Riwayat</h1>
    <p>Aktivitas pembayaran bulan ini</p>
</header>

<div id="history-log" class="history-list">
    <div class="empty-msg">Memuat data...</div>
</div>

</div>

<footer class="bottom-nav">
    <a href="dashboard.html" class="nav-item"><span>üè†</span>Home</a>
    <a href="calendar.html" class="nav-item"><span>üìÖ</span>Bayar</a>
    <a href="history.html" class="nav-item active"><span>üóíÔ∏è</span>Riwayat</a>
    <a href="settings.html" class="nav-item"><span>‚öôÔ∏è</span>Setting</a>
</footer>

<script>
const userData = {
    tarifNormal: 70000,
    tarifMakaPlus: 10000
};

// Baca dari localStorage (source of truth sama dengan calendar.html)
const savedPayments = JSON.parse(localStorage.getItem('maka_payments')) || {};
const logContainer = document.getElementById('history-log');

function formatRupiah(number) {
    return new Intl.NumberFormat('id-ID', {
        style: 'currency', currency: 'IDR',
        minimumFractionDigits: 0
    }).format(number);
}

function generateHistory() {
    const today = new Date();
    let logHTML = '';
    let hasData = false;

    // Loop 30 hari ke belakang
    for (let i = 0; i < 30; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);

        const y = date.getFullYear();
        const m = date.getMonth() + 1;
        const d = date.getDate();

        const key = `${y}-${m}-${d}`;
        const displayDate = date.toLocaleDateString('id-ID', {
            weekday: 'short', day: 'numeric', month: 'short'
        });

        // Logika Status & Harga (Sederhana)
        let amount = userData.tarifNormal;
        let typeName = 'Sewa Harian';
        let statusClass = 'card-unpaid';
        let statusText = 'Tunggakan';
        let isSpecialDate = false;

        // Cek tanggal khusus (Cicilan DP tgl 14 & 28) - Logika sederhana visual
        if (d === 14 || d === 28) {
            amount = 80000;
            typeName = 'Cicilan DP';
            isSpecialDate = true;
        }

        const paid = savedPayments[key] === true;

        if (paid) {
            statusClass = isSpecialDate ? 'card-dp' : 'card-paid';
            statusText = 'Lunas';
        } else {
            statusClass = 'card-unpaid';
            statusText = 'Belum Bayar';
        }

        // Generate HTML Kartu
        logHTML += `
            <div class="history-card ${statusClass}">
                <div class="h-info">
                    <span class="h-type">${typeName}</span>
                    <span class="h-date">${displayDate}</span>
                </div>
                <div class="h-amount-box">
                    <div class="h-amount">${formatRupiah(amount)}</div>
                    <div class="h-status">${statusText}</div>
                </div>
            </div>
        `;
        hasData = true;
    }

    if(hasData) {
        logContainer.innerHTML = logHTML;
    } else {
        logContainer.innerHTML = `<div class="empty-msg">Belum ada riwayat transaksi.</div>`;
    }
}

document.addEventListener('DOMContentLoaded', generateHistory);
</script>

</body>
</html>
