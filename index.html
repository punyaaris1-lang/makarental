<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Masuk - MAKA Motors</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<link rel="manifest" href="/makarental/manifest.json"> 
    
<style>
/* === MAKA MOTORS THEME === */
:root { 
    --maka-black: #0f1724; 
    --maka-white: #ffffff;
    --maka-yellow: #fbbf24;
    --maka-teal: #0ea5a6;
    --bg-page: #f8fafc;
    --border-color: #e2e8f0;
    --danger: #ef4444;
}

* { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body { 
    margin:0; padding:0; font-family:'Inter', sans-serif; 
    background-color: var(--bg-page); color: var(--maka-black); 
    min-height:100vh; display: flex; flex-direction: column; 
    align-items: center; justify-content: center;
}

.auth-container { 
    width:100%; max-width:400px; padding:30px 24px; 
}

/* BRANDING */
.brand-area { text-align: center; margin-bottom: 40px; }
.brand-title { 
    font-family:'Syne', sans-serif; font-size: 2em; font-weight:800; 
    color: var(--maka-black); letter-spacing: -1px; margin: 0;
}
.brand-subtitle { 
    color: #64748b; font-size: 0.9em; margin-top: 5px; font-weight: 500;
}

/* TABS */
.tabs { 
    display:flex; border-bottom: 2px solid var(--border-color); 
    margin-bottom: 30px; 
}
.tab-btn { 
    flex:1; padding:12px; border:none; background:transparent; 
    color: #94a3b8; font-weight:700; cursor:pointer; 
    font-family: 'Inter'; font-size: 0.9em; transition: 0.3s;
    border-bottom: 2px solid transparent; margin-bottom: -2px;
}
.tab-btn.active { 
    color: var(--maka-black); border-bottom-color: var(--maka-black); 
}

/* FORM */
.form-view { display:none; animation: fadeUp 0.4s ease; } 
.form-view.active { display:block; }
@keyframes fadeUp { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

.form-group { margin-bottom:20px; }
label { 
    display:block; font-size:0.75em; font-weight:700; color: #64748b; 
    margin-bottom:8px; text-transform:uppercase; letter-spacing: 0.5px; 
}
input, select { 
    width:100%; padding:14px; border-radius: 12px; 
    border:1px solid var(--border-color); background: var(--maka-white); 
    outline:none; font-size: 1em; font-family: 'Inter'; font-weight: 600;
    color: var(--maka-black); transition: 0.2s;
}
input:focus { border-color: var(--maka-black); }

/* BUTTONS */
.btn-primary { 
    width:100%; padding:16px; border:none; border-radius: 12px; 
    background: var(--maka-black); color: var(--maka-white); 
    font-weight:700; font-size: 1em; cursor:pointer; 
    font-family: 'Syne'; transition: 0.2s; margin-top: 10px;
}
.btn-primary:active { transform: scale(0.98); opacity: 0.9; }
.btn-primary:disabled { background: #cbd5e1; cursor: not-allowed; }

/* MODAL POPUP (Updated Font) */
.modal-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(5px);
    z-index:9999; display:none; align-items:center; justify-content:center;
}
.modal-box {
    background:white; width:85%; max-width:320px; padding:30px; border-radius:24px;
    text-align:center; box-shadow:0 25px 50px rgba(0,0,0,0.2);
}
.modal-icon { font-size:40px; margin-bottom:15px; display:block; }
.modal-title { 
    font-family:'Syne'; font-size:1.4em; font-weight:800; 
    margin:0 0 10px; color:var(--maka-black); 
}
.modal-desc { 
    font-size:0.95em; color:#64748b; line-height:1.5; margin-bottom:25px; 
}
.btn-modal { 
    width: 100%; padding:14px; border-radius:12px; border:none; 
    background: var(--maka-black); color:white; font-weight:700; cursor:pointer; 
}
</style>
</head>
<body>

<div class="auth-container">
  <div class="brand-area">
    <h1 class="brand-title">MAKA MOTORS</h1>
    <p class="brand-subtitle">RTO & Charging System</p>
  </div>

  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('login')">MASUK</button>
    <button class="tab-btn" onclick="switchTab('register')">DAFTAR BARU</button>
  </div>

  <div id="view-login" class="form-view active">
    <div class="form-group">
      <label>Plat Nomor Kendaraan</label>
      <input id="l-plat" type="text" placeholder="B xxxx XXX" style="text-transform:uppercase;">
    </div>
    <button id="btnLogin" class="btn-primary" onclick="handleLogin()">MASUK APLIKASI</button>
  </div>

  <div id="view-register" class="form-view">
    <div class="form-group"><label>Nama Lengkap</label><input id="r-nama" placeholder="Sesuai KTP"></div>
    <div class="form-group"><label>Nomor WhatsApp</label><input id="r-hp" type="tel" placeholder="08xxxxxxxxxx"></div>
    <div class="form-group"><label>Plat Nomor</label><input id="r-plat" placeholder="B xxxx XXX" style="text-transform:uppercase;"></div>
    <div class="form-group"><label>Tanggal Ambil Motor</label><input id="r-tgl" type="date"></div>
    <div class="form-group"><label>Opsi DP</label>
      <select id="r-dp">
          <option value="355">DP 355.000 (Cicil)</option>
          <option value="755">DP 755.000 (Langsung)</option>
      </select>
    </div>
    <button id="btnReg" class="btn-primary" onclick="handleRegister()">DAFTAR SEKARANG</button>
  </div>
</div>

<div id="customModal" class="modal-overlay">
    <div class="modal-box">
        <span id="mIcon" class="modal-icon">ðŸ””</span>
        <h3 id="mTitle" class="modal-title">Info</h3>
        <p id="mDesc" class="modal-desc">Pesan...</p>
        <button class="btn-modal" onclick="closeModal()">OK, SIAP</button>
    </div>
</div>

<script>
// CONFIG FIREBASE (Sama seperti sebelumnya)
const firebaseConfig = {
  apiKey: "AIzaSyAk3G5aQUBVe_g7_peVu1F6xllP_RejGq0",
  authDomain: "rtomaka-e67b5.firebaseapp.com",
  projectId: "rtomaka-e67b5",
  storageBucket: "rtomaka-e67b5.firebasestorage.app",
  messagingSenderId: "472036722228",
  appId: "1:472036722228:web:11d520f9204db317d02c61"
};

let db;
try { firebase.initializeApp(firebaseConfig); db = firebase.firestore(); } catch(e){}

// UI FUNCTIONS
function showModal(title, msg, type="info") {
    const modal = document.getElementById('customModal');
    document.getElementById('mTitle').innerText = title;
    document.getElementById('mDesc').innerText = msg;
    document.getElementById('mIcon').innerText = type === "error" ? "âš ï¸" : (type === "success" ? "âœ…" : "ðŸ””");
    modal.style.display = 'flex';
}
function closeModal() { document.getElementById('customModal').style.display = 'none'; }

function switchTab(mode) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  document.querySelectorAll('.form-view').forEach(v=>v.classList.remove('active'));
  document.getElementById('view-'+mode).classList.add('active');
}

// AUTH LOGIC
function handleLogin() {
  const plat = document.getElementById('l-plat').value.trim().toUpperCase();
  const btn = document.getElementById('btnLogin');
  
  if(!plat) return showModal("Input Kosong", "Mohon isi Plat Nomor Anda.", "error");
  
  btn.innerText = "MEMERIKSA..."; btn.disabled = true;

  db.collection('users').doc(plat).get().then((doc) => {
    if (doc.exists) {
      if(doc.data().isBanned) {
        showModal("Akses Ditolak", "Akun Anda diblokir.", "error");
        btn.disabled = false; btn.innerText = "MASUK APLIKASI";
        return;
      }
      localStorage.setItem('maka_user', JSON.stringify(doc.data()));
      window.location.href = 'dashboard.html';
    } else {
      showModal("Tidak Ditemukan", "Plat nomor belum terdaftar. Silakan Daftar Baru.", "error");
      btn.disabled = false; btn.innerText = "MASUK APLIKASI";
    }
  }).catch(err => {
      console.error(err);
      showModal("Gagal", "Periksa koneksi internet.", "error");
      btn.disabled = false; btn.innerText = "MASUK APLIKASI";
  });
}

function handleRegister() {
  const nama = document.getElementById('r-nama').value.trim();
  const hp = document.getElementById('r-hp').value.trim();
  const plat = document.getElementById('r-plat').value.trim().toUpperCase();
  const tgl = document.getElementById('r-tgl').value;
  const dp = document.getElementById('r-dp').value;
  
  if(!nama || !hp || !plat || !tgl) return showModal("Data Kurang", "Lengkapi semua formulir.", "error");

  const btn = document.getElementById('btnReg');
  btn.innerText = "MENDAFTAR..."; btn.disabled = true;

  db.runTransaction(async (t) => {
    const docRef = db.collection('users').doc(plat);
    const doc = await t.get(docRef);
    if(doc.exists) throw "Plat nomor sudah terdaftar!";
    
    const userData = {
        nama, hp, plat, tglAmbil: tgl, dp,
        joinedAt: new Date(tgl).toISOString(), isBanned: false
    };
    t.set(docRef, userData);
    return userData;
  }).then((ud) => {
      localStorage.setItem('maka_user', JSON.stringify(ud));
      showModal("Sukses", "Pendaftaran Berhasil!", "success");
      setTimeout(()=> window.location.href='dashboard.html', 1500);
  }).catch(err => {
      showModal("Gagal", err.toString().replace("Error: ", ""), "error");
      btn.disabled = false; btn.innerText = "DAFTAR SEKARANG";
  });
}
</script>
</body>
</html>
