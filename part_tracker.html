<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maintenance - MAKA</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg: #05080A;
            --cyan: #00F0FF;
            --volt: #D9FF00;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.12);
            --text-soft: #CBD5E1; /* Putih tulang terang agar kontras di bg hitam */
            --font-display: 'Space Grotesk', sans-serif;
        }

        body {
            margin: 0; padding: 25px; font-family: 'Inter', sans-serif;
            background: var(--bg); color: white; padding-bottom: 120px;
        }

        h1 { font-family: var(--font-display); font-size: 32px; margin-bottom: 5px; letter-spacing: -1px; }
        .sub-h1 { font-size: 11px; color: var(--cyan); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 30px; font-weight: 700; opacity: 0.9; }

        /* Part Grid */
        .part-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .part-card {
            background: var(--glass); border: 1px solid var(--border);
            padding: 25px 15px; border-radius: 25px; text-align: center;
            backdrop-filter: blur(10px);
        }
        .p-name { font-size: 10px; color: var(--text-soft); font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 15px; }
        .p-val { font-family: var(--font-display); font-size: 36px; font-weight: 700; color: white; margin-bottom: 2px; }
        .p-label { font-size: 10px; color: var(--cyan); font-weight: 700; margin-bottom: 18px; display: block; opacity: 0.8; }

        /* Progress Bar Neon */
        .p-bar-bg { width: 100%; height: 6px; background: #111; border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
        .p-bar-fill { height: 100%; border-radius: 10px; transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        .fill-cyan { background: var(--cyan); box-shadow: 0 0 15px rgba(0, 240, 255, 0.4); }

        /* Action Button */
        .btn-claim {
            width: 100%; padding: 18px; border-radius: 18px; border: none;
            background: var(--glass); color: white; font-family: var(--font-display);
            font-weight: 700; font-size: 14px; border: 1px solid var(--border);
            cursor: pointer; transition: 0.3s; margin-bottom: 35px;
        }
        .btn-claim:active { background: var(--cyan); color: #000; border-color: var(--cyan); }

        /* Log History */
        .log-sec h3 { font-family: var(--font-display); font-size: 16px; color: var(--volt); margin-bottom: 20px; letter-spacing: 0.5px; }
        .log-item {
            padding: 16px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; background: rgba(255,255,255,0.01);
        }
        .log-item b { color: white; }
        .l-date { font-size: 11px; color: var(--text-soft); font-weight: 600; opacity: 0.7; }

        /* Nav Bawah */
        .nav-bottom {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 75px;
            background: rgba(10, 15, 20, 0.85); backdrop-filter: blur(25px);
            border: 1px solid var(--border); border-radius: 25px;
            display: flex; justify-content: space-around; align-items: center; z-index: 1000;
        }
        .nav-item { text-decoration: none; color: #444; font-size: 10px; font-weight: 700; text-align: center; }
        .nav-item.active { color: var(--cyan); }
        .nav-item span { display: block; font-size: 24px; margin-bottom: 4px; }

        /* Modal Claim */
        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(10px);
        }
        .m-box {
            width: 85%; max-width: 350px; background: #0A0A0A; border: 1px solid var(--border);
            padding: 35px 25px; border-radius: 35px; text-align: center;
        }
        select {
            width: 100%; padding: 16px; background: #000; border: 1px solid var(--border);
            color: white; border-radius: 15px; margin: 25px 0; font-family: 'Inter'; font-size: 14px; outline: none;
        }
        .btn-ok { width: 100%; padding: 18px; background: var(--volt); color: #000; border: none; border-radius: 15px; font-weight: 800; font-family: var(--font-display); cursor: pointer; }
    </style>
</head>
<body>

    <h1>Maintenance<span>.</span></h1>
    <div class="sub-h1">Status Jatah Sparepart Gratis</div>

    <div id="partList" class="part-grid">
        </div>

    <button class="btn-claim" onclick="openM()">üõ†Ô∏è KLAIM PENGGANTIAN UNIT</button>

    <div class="log-sec">
        <h3>Riwayat Maintenance</h3>
        <div id="logList">
            <div style="color:var(--text-soft); font-size:12px; text-align:center; padding:30px; opacity: 0.5;">Belum ada riwayat klaim part.</div>
        </div>
    </div>

    <div id="modal">
        <div class="m-box">
            <div style="font-size:10px; color:var(--cyan); letter-spacing:2px; font-weight:700; text-transform:uppercase;">Pilih Part Baru</div>
            <select id="selPart"></select>
            <button class="btn-ok" onclick="save()">KONFIRMASI PENGGANTIAN</button>
            <p onclick="closeM()" style="color:var(--text-soft); font-size:12px; margin-top:20px; cursor:pointer; font-weight:700;">Batalkan</p>
        </div>
    </div>

    <nav class="nav-bottom">
        <a href="dashboard.html" class="nav-item"><span>üè†</span>HOME</a>
        <a href="calendar.html" class="nav-item"><span>üìÖ</span>BAYAR</a>
        <a href="https://punyaaris1-lang.github.io/antricukk/antrian.html" class="nav-item"><span>‚ö°</span>ANTRIAN</a>
        <a href="history.html" class="nav-item"><span>üìú</span>HISTORY</a>
    </nav>

    <script>
        let LIMITS = JSON.parse(localStorage.getItem('maka_part_limits')) || { ban_depan: 3, ban_belakang: 3, kampas_depan: 3, kampas_belakang: 3 };
        let usage = JSON.parse(localStorage.getItem('maka_part_usage')) || { ban_depan: 0, ban_belakang: 0, kampas_depan: 0, kampas_belakang: 0, history: [] };
        const PARTS = [
            {k:'ban_depan', n:'Ban Depan'},
            {k:'ban_belakang', n:'Ban Belakang'},
            {k:'kampas_depan', n:'Kampas Depan'},
            {k:'kampas_belakang', n:'Kampas Belakang'}
        ];

        function render() {
            const grid = document.getElementById('partList'), sel = document.getElementById('selPart');
            grid.innerHTML = ''; 
            sel.innerHTML = '<option value="">-- PILIH SPAREPART --</option>';

            PARTS.forEach(p => {
                const lim = LIMITS[p.k] || 3, used = usage[p.k] || 0, rem = lim - used;
                const pct = (rem / lim) * 100;

                grid.innerHTML += `
                    <div class="part-card">
                        <div class="p-name">${p.n}</div>
                        <div class="p-val">${rem}</div>
                        <span class="p-label">SISA JATAH</span>
                        <div class="p-bar-bg">
                            <div class="p-bar-fill fill-cyan" style="width:${pct}%"></div>
                        </div>
                    </div>
                `;
                if(rem > 0) sel.innerHTML += `<option value="${p.k}">${p.n}</option>`;
            });

            const lBox = document.getElementById('logList'), h = usage.history || [];
            lBox.innerHTML = h.length === 0 ? '<div style="color:var(--text-soft); font-size:12px; text-align:center; padding:30px; opacity:0.5;">Belum ada riwayat klaim part.</div>' : 
                h.slice().reverse().map(x => `
                    <div class="log-item">
                        <b>${PARTS.find(i=>i.k===x.key)?.n || x.key}</b>
                        <span class="l-date">${x.date}</span>
                    </div>
                `).join('');
        }

        function openM(){ document.getElementById('modal').style.display='flex'; }
        function closeM(){ document.getElementById('modal').style.display='none'; }
        
        function save() {
            const k = document.getElementById('selPart').value;
            if(!k) return alert("Pilih part!");
            
            usage[k] = (usage[k] || 0) + 1;
            if(!usage.history) usage.history = [];
            usage.history.push({
                key: k, 
                date: new Date().toLocaleDateString('id-ID', {day:'numeric', month:'short', year:'numeric'})
            });
            
            localStorage.setItem('maka_part_usage', JSON.stringify(usage));
            closeM(); render();
        }

        document.addEventListener('DOMContentLoaded', render);
    </script>
</body>
</html>
