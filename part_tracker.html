<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Gratisan Part</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&family=Syne:wght@700&display=swap" rel="stylesheet">

<style>
/* ================= GLOBAL PREMIUM THEME ================= */
:root {
  --bg-base: #f0f4f8;
  --accent: #0ea5a6;
  --accent-2: #06b6d4;
  --text: #0f1724;
  --muted: #64748b;
  --danger: #ef4444;
  --success: #10b981;
  
  --glass-bg: rgba(255, 255, 255, 0.65);
  --glass-border: rgba(255, 255, 255, 0.4);
  --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
  --backdrop-blur: blur(12px);
  
  --radius-lg: 24px;
  --max-width: 520px;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  margin: 0; padding: 0;
  font-family: 'Inter', sans-serif;
  background-color: var(--bg-base);
  color: var(--text);
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: "";
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: url('1763947427555.jpg') center/cover no-repeat; 
  opacity: 0.15; z-index: -1; pointer-events: none;
}

.app-container {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: 20px 20px 120px 20px;
}

/* HEADER */
.header { margin-bottom: 24px; }
.header h1 {
  font-family: 'Syne', sans-serif; font-size: 1.8em; font-weight: 800;
  margin: 0; color: var(--text); letter-spacing: -0.5px;
}
.header p { color: var(--muted); font-size: 0.9em; margin: 4px 0 0 0; }

/* GRID CARD */
.part-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;
}

.part-card {
  background: var(--glass-bg);
  box-shadow: var(--glass-shadow);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  padding: 16px;
  display: flex; flex-direction: column; justify-content: space-between;
}

.part-name { font-weight: 700; font-size: 0.9em; margin: 0 0 8px 0; color: var(--text); }
.part-limit { font-size: 0.75em; color: var(--muted); margin-bottom: 8px; }
.highlight-num { font-weight: 800; font-size: 1.2em; color: var(--accent); }

/* PROGRESS BAR */
.progress-track {
  width: 100%; height: 6px; background: rgba(0,0,0,0.05);
  border-radius: 99px; overflow: hidden; margin-bottom: 8px;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  border-radius: 99px; transition: width 0.5s ease;
}
.progress-fill.empty { background: var(--danger); }

/* BUTTON ACTION */
.btn-action {
  width: 100%; padding: 16px; border-radius: 16px;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  color: white; border: none; font-weight: 800; font-size: 1em; cursor: pointer;
  box-shadow: 0 8px 20px rgba(14, 165, 166, 0.2);
  display: flex; justify-content: center; align-items: center; gap: 8px;
  text-decoration: none; margin-bottom: 30px;
}
.btn-action:active { transform: scale(0.98); }

/* LOG RIWAYAT SECTION */
.log-section h3 { font-family: 'Syne'; font-size: 1.2em; margin-bottom: 12px; }
.log-list {
  background: var(--glass-bg);
  backdrop-filter: var(--backdrop-blur);
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  padding: 10px;
}
.log-item {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 0.9em;
}
.log-item:last-child { border-bottom: none; }
.log-date { font-size: 0.8em; color: var(--muted); display: block; }
.log-part { font-weight: 700; color: var(--text); }

/* MODAL */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
  display: none; align-items: center; justify-content: center; z-index: 2000;
}
.modal-content {
  background: #fff; width: 85%; max-width: 320px; padding: 24px;
  border-radius: 24px; text-align: center;
  box-shadow: 0 20px 50px rgba(0,0,0,0.2);
}
.modal-content h3 { font-family: 'Syne'; margin: 0 0 10px; font-size: 1.4em; }
select {
  width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd;
  background: #f8fafc; margin-bottom: 20px; font-size: 1em; outline: none;
}
.btn-row { display: flex; gap: 10px; }
.btn-ok { flex: 1; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 12px; font-weight: 700; }
.btn-cancel { flex: 1; padding: 12px; background: #f1f5f9; color: var(--muted); border: none; border-radius: 12px; font-weight: 700; }

/* NAV STANDAR */
footer.bottom-nav {
  position: fixed; left: 50%; transform: translateX(-50%); bottom: 20px;
  width: calc(100% - 40px); max-width: 480px;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  border-radius: 999px; padding: 12px 20px; display: flex; justify-content: space-around;
  align-items: center; box-shadow: 0 15px 40px rgba(0,0,0,0.1);
  border: 1px solid rgba(255,255,255,0.5); z-index: 999;
}
.nav-item {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  text-decoration: none; color: var(--muted); font-size: 11px; gap: 4px; transition: 0.2s;
}
.nav-item span { font-size: 20px; margin-bottom: 2px; }
.nav-item.active { color: var(--accent); font-weight: 700; }
.nav-item.active span { transform: scale(1.1); filter: drop-shadow(0 2px 4px rgba(14,165,166,0.3)); }
</style>
</head>

<body>
<div class="app-container">
    <header class="header">
        <h1>Cek Gratisan</h1>
        <p>Jatah part gratis 3 tahun</p>
    </header>

    <div id="part-tracker" class="part-grid"></div>

    <button class="btn-action" onclick="openModal()">
        <span>üìù</span> CATAT PENGGUNAAN BARU
    </button>
    
    <div class="log-section">
        <h3>Riwayat Penggantian</h3>
        <div id="log-list" class="log-list">
            <div style="text-align:center; padding:15px; color:#999; font-size:0.8em;">Belum ada data.</div>
        </div>
    </div>
</div>

<div id="modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Catat Penggantian</h3>
        <p style="color:#666; font-size:0.9em; margin-bottom:15px;">Pilih part yang diganti hari ini:</p>
        <select id="partSelect">
            <option value="">-- Pilih Part --</option>
        </select>
        <div class="btn-row">
            <button class="btn-cancel" onclick="closeModal()">Batal</button>
            <button class="btn-ok" onclick="saveUsage()">Konfirmasi</button>
        </div>
    </div>
</div>

<footer class="bottom-nav">
  <a href="lokasi_fc.html" class="nav-item"><span>‚ö°</span>Lokasi</a>
  <a href="dashboard.html" class="nav-item"><span>üè†</span>Home</a>
  <a href="daftar_antrian.html" class="nav-item"><span>üé´</span>Antrian</a>
</footer>

<script>
// Data
let PART_LIMITS = JSON.parse(localStorage.getItem('maka_part_limits')) || {
    ban_depan: 3, ban_belakang: 3, kampas_depan: 3, kampas_belakang: 3
};
let partUsage = JSON.parse(localStorage.getItem('maka_part_usage')) || {
    ban_depan: 0, ban_belakang: 0, kampas_depan: 0, kampas_belakang: 0, 
    history: [] // New: Array untuk menyimpan log riwayat
};

function getParts() {
    return [
        { key: 'ban_depan', name: 'Ban Depan' },
        { key: 'ban_belakang', name: 'Ban Belakang' },
        { key: 'kampas_depan', name: 'Kampas Depan' },
        { key: 'kampas_belakang', name: 'Kampas Belakang' }
    ];
}

function render() {
    // 1. Render Cards
    const container = document.getElementById('part-tracker');
    const select = document.getElementById('partSelect');
    container.innerHTML = '';
    select.innerHTML = '<option value="">-- Pilih Part --</option>';

    getParts().forEach(p => {
        const limit = PART_LIMITS[p.key] || 3;
        const used = partUsage[p.key] || 0;
        const remaining = limit - used;
        const percent = (used / limit) * 100;
        
        const barClass = remaining <= 0 ? 'progress-fill empty' : 'progress-fill';
        const color = remaining <= 0 ? 'var(--danger)' : 'var(--accent)';

        container.innerHTML += `
            <div class="part-card">
                <div>
                    <div class="part-name">${p.name}</div>
                    <div class="progress-track"><div class="${barClass}" style="width:${percent}%"></div></div>
                </div>
                <div class="part-limit">Sisa: <span class="highlight-num" style="color:${color}">${remaining}</span> / ${limit}</div>
            </div>`;
        
        if (remaining > 0) {
            select.innerHTML += `<option value="${p.key}">${p.name}</option>`;
        }
    });

    // 2. Render History Log
    const logContainer = document.getElementById('log-list');
    const history = partUsage.history || [];
    
    if(history.length === 0) {
        logContainer.innerHTML = '<div style="text-align:center; padding:15px; color:#999; font-size:0.8em;">Belum ada data.</div>';
    } else {
        // Urutkan dari yang terbaru (reverse)
        logContainer.innerHTML = history.slice().reverse().map(h => {
            // Cari nama part cantik
            const pName = getParts().find(x => x.key === h.key)?.name || h.key;
            return `
            <div class="log-item">
                <div class="log-part">${pName}</div>
                <small class="log-date">${h.date}</small>
            </div>`;
        }).join('');
    }
}

function openModal() { document.getElementById('modal').style.display = 'flex'; }
function closeModal() { document.getElementById('modal').style.display = 'none'; }

function saveUsage() {
    const key = document.getElementById('partSelect').value;
    if (!key) return alert("Pilih part dulu!");
    
    // Update Counter
    partUsage[key] = (partUsage[key] || 0) + 1;
    
    // Update History Log with Date
    const today = new Date().toLocaleDateString('id-ID', {
        day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute:'2-digit'
    });
    
    if(!partUsage.history) partUsage.history = [];
    partUsage.history.push({ key: key, date: today });
    
    localStorage.setItem('maka_part_usage', JSON.stringify(partUsage));
    closeModal();
    render();
    alert("Berhasil dicatat!");
}

document.addEventListener('DOMContentLoaded', render);
</script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('PWA Registered'))
        .catch(err => console.log('PWA Error', err));
    });
  }
  </script>
  
</body>
</html>
